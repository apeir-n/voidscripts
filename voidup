#!/bin/sh

style () {
    local text="$1"
    local brdr="$2"
    shift 2
    gum style                           \
        --foreground="$text"            \
        --border="rounded"              \
        --border-foreground="$brdr"     \
        "$@"
}

pupdate () {
    style 13 12 " updating python packages with pipx: "
    pipx upgrade-all                                    \
        && style 12 13 " pipx update succeeded   "     \
        || style 12 13 "   pipx update failed "
}

rupdate () {
    style 12 11 " updating rust packages with cargo: "
    cargo install-update -a                             \
        && style 11 12 " cargo update succeeded   "    \
        || style 11 12 "   cargo update failed "
}

gupdate () {
    style 11 10 " updating go packages with gup: "
    gup update                                          \
        && style 10 11 " gup update succeeded   "      \
        || style 10 11 "   gup update failed "
}

style 10 11 "   updating void linux   "

style 12 11 " running system upgrade... "
doas xbps-install -Su

style 11 10 " cleaning orphaned packages... "
doas xbps-remove -o

style 10 9 " updating source tree... "
cd $HOME/.local/share/void-packages
git checkout master
git pull

setsid -f herbe "   void updated.   "

echo

while true; do
    choice=$(
        gum choose                                                      \
            --header="update lanugage build system packages?"           \
            --cursor="- "                                               \
            --header.foreground=10                                      \
            --cursor.foreground=9                                       \
            --item.foreground=13                                        \
            "yes" "no" "py" "rs" "go"
            )
    case "$choice" in
        yes)
            style 14 9 " beginning language package updater. "
            sleep 1

            pupdate
            rupdate
            gupdate

            style 14 9 " language packages updated. "
            break
            ;;
        no)
            style 10 11 " bye! "
            break
            ;;
        py)
            pupdate
            ;;
        rs)
            rupdate
            ;;
        go)
            gupdate
            ;;
        *)
            style 7 8 " invalid response. "
            ;;
    esac
done
