#!/bin/bash

# change the uname thing

style(){
    local text="$1"
    local brdr="$2"
    shift 2
    gum style                           \
        --foreground="$text"            \
        --border="rounded"              \
        --border-foreground="$brdr"     \
        "$@"
}

VOIDATA="$HOME/Documents/void"

style 10 11 "  updating void linux  "

style 13 12 "backing up package list..."
xpkg -m > $VOIDATA/pkglist.txt

style 12 11 "running full system upgrade..."
doas xbps-install -Su

style 11 10 "cleaning orphaned packages..."
doas xbps-remove -o

style 10 9 "updating source tree..."
cd $HOME/.local/share/void-packages
git checkout master
git pull upstream master

#style 12 13 "logging updated kernel version..."
#echo "$(date '+%y%m%d_%I:%M%P') - kernel version: $(uname -r)" >> $VOIDATA/kernelversions.txt
#
#style 11 12                                     \
#    "  void updated.  "                       \
#    "compare the last two kernel versions to"   \
#    "determine if a system reboot is necessary:"
#tail -n 2 $VOIDATA/kernelversions.txt
#
#setsid -f                                                               \
#    herbe                                                               \
#        "  void updated.  "                                           \
#        " "                                                             \
#        "$(tail -n 2 $VOIDATA/kernelversions.txt | awk '{print $5}')"   \
#        " "                                                             \
#        " reboot if kernel was updated."

setsid -f herbe "  void updated.  "

echo

while true; do
    choice=$(
        gum choose                                                      \
            --header="update lanugage build system packages?"           \
            --cursor="- "                                               \
            --header.foreground=10                                      \
            --cursor.foreground=9                                       \
            --item.foreground=13                                        \
            "yes" "no"
        )
    case "$choice" in
        yes)
            packup
            break
            ;;
        no)
            style 10 11 "skipped lang packages update."
            break
            ;;
        *)
            style 7 8 "invalid response."
            ;;
    esac
done
